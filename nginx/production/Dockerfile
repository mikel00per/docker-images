ARG NGINX_VERSION

FROM nginx:${NGINX_VERSION}

RUN apk update; \
    apk upgrade; \
    apk add bash;

ARG NGINX_CONFIG_SOURCE
ARG NGINX_CONFIG_TARGET

COPY ${NGINX_CONFIG_SOURCE} ${NGINX_CONFIG_TARGET}

ARG PHP_NAME
ENV PHP_NAME=$PHP_NAME
RUN sed -i "s/php:9000/$PHP_NAME:9000/g" ${NGINX_CONFIG_TARGET}

ARG PHP_HEALTHCHECK_SOURCE
ARG PHP_HEALTHCHECK_TARGET
COPY ${PHP_HEALTHCHECK_SOURCE} ${PHP_HEALTHCHECK_TARGET}

HEALTHCHECK --interval=10s --timeout=3s --retries=3 CMD ["docker-healthcheck"]

ARG NGINX_HTTP_PORT
EXPOSE ${NGINX_HTTP_PORT}