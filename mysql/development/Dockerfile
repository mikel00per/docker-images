ARG MYSQL_VERSION

FROM mysql:${MYSQL_VERSION}

RUN apt update; \
    apt upgrade -y;

ARG MYSQL_DATABASE
ARG MYSQL_USER
ARG MYSQL_PASSWORD
ARG MYSQL_ROOT_PASSWORD
ENV MYSQL_DATABASE=$MYSQL_DATABASE
ENV MYSQL_USER=$MYSQL_USER
ENV MYSQL_PASSWORD=$MYSQL_PASSWORD
ENV MYSQL_ROOT_PASSWORD=$MYSQL_ROOT_PASSWORD

ARG MYSQL_CONFIG_TARGET
ARG MYSQL_CONFIG_SOURCE

COPY ${MYSQL_CONFIG_SOURCE} ${MYSQL_CONFIG_TARGET}

ARG MYSQL_HEALTHCHECK_SOURCE
ARG MYSQL_HEALTHCHECK_TARGET
COPY ${MYSQL_HEALTHCHECK_SOURCE} ${MYSQL_HEALTHCHECK_TARGET}

HEALTHCHECK --interval=10s --timeout=3s --retries=3 CMD ["docker-healthcheck"]
